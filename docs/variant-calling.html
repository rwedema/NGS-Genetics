<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>5 Analysis of Variants | Minor DSLS - Genomics Project</title>
<meta name="author" content="Marcel Kempenaar and Ronald Wedema">
<meta name="description" content="Once we are done with mapping all reads to the reference genome, we can determine the variant positions within the genes of interest. For this we use a Galaxy tool called LoFreq that will report...">
<meta name="generator" content="bookdown 0.36 with bs4_book()">
<meta property="og:title" content="5 Analysis of Variants | Minor DSLS - Genomics Project">
<meta property="og:type" content="book">
<meta property="og:description" content="Once we are done with mapping all reads to the reference genome, we can determine the variant positions within the genes of interest. For this we use a Galaxy tool called LoFreq that will report...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="5 Analysis of Variants | Minor DSLS - Genomics Project">
<meta name="twitter:description" content="Once we are done with mapping all reads to the reference genome, we can determine the variant positions within the genes of interest. For this we use a Galaxy tool called LoFreq that will report...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.9.0/transition.js"></script><script src="libs/bs3compat-0.9.0/tabs.js"></script><script src="libs/bs3compat-0.9.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Minor DSLS - Genomics Project</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">About</a></li>
<li><a class="" href="intro.html"><span class="header-section-number">1</span> Intro Genomics Project</a></li>
<li><a class="" href="quality-control.html"><span class="header-section-number">2</span> Data and quality control</a></li>
<li><a class="" href="mapping.html"><span class="header-section-number">3</span> Read Mapping</a></li>
<li><a class="" href="mapping-qc.html"><span class="header-section-number">4</span> Mapping Quality Control</a></li>
<li><a class="active" href="variant-calling.html"><span class="header-section-number">5</span> Analysis of Variants</a></li>
<li><a class="" href="variant-annotation.html"><span class="header-section-number">6</span> Variant Annotation</a></li>
<li><a class="" href="variant-visualization.html"><span class="header-section-number">7</span> Variant Visualization</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/rwedema/NGS-Genetics/">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="variant-calling" class="section level1" number="5">
<h1>
<span class="header-section-number">5</span> Analysis of Variants<a class="anchor" aria-label="anchor" href="#variant-calling"><i class="fas fa-link"></i></a>
</h1>
<p>Once we are done with mapping all reads to the reference genome, we can determine the variant positions within the genes of interest. For this we use a Galaxy tool called <em>LoFreq</em> that will report on found variants and their statistics such as allele frequency, number of supported reads, average base quality at the found position, etc.</p>
<div id="variants" class="section level2" number="5.1">
<h2>
<span class="header-section-number">5.1</span> Finding and Annotating Variants<a class="anchor" aria-label="anchor" href="#variants"><i class="fas fa-link"></i></a>
</h2>
<p>Most likely you’ve already seen how a true variant (not a single or few mismatches) looks when we looked at the data in the IGV-browser. For such a variant you see a number of reads having a different base at that positions compared to the reference genome. As we’ve mentioned before, we are interested in all these variants in our patient data for the all the genes in our gene panel. The previous <em>visualize-your-data</em> assignment did not ask to find all these variants using the IGV-browser because in this section we are going to use a program to do this for us.</p>
<p>The tool that we will use is the <a href="https://csb5.github.io/lofreq/">LoFreq</a> tool that scans the BAM file for variants. This tool has a few settings that, combined, defines when a position is called a variant. You could do this in a naive way and just report for each position if there is a change. But this will result in many false positive variants (can you explain this?). We need a more statistical approach to filter out low quality variants and that’s why the tool has settings to for instance set the minimum amount of reads (coverage) at a position to consider looking for variations. Also the variants itself should be supported by a minimum number of reads and the base quality of that position should not be too low.</p>
<p><strong>Instructions</strong>:</p>
<p>Run the <code>Call variants with LoFreq</code> tool using its default settings. Select the output BAM file from the Mark Duplicate tool and use the available <code>GRCh38</code> reference genome. Feel free to explore the other options but leave the <code>Call variants across</code> settings on <code>Whole reference</code> (this setting allows using a BED file for only selecting variants of interest which is basically the following assignment).</p>
</div>
<div id="variant-filtering" class="section level2" number="5.2">
<h2>
<span class="header-section-number">5.2</span> VCF File Filtering<a class="anchor" aria-label="anchor" href="#variant-filtering"><i class="fas fa-link"></i></a>
</h2>
<p>The result of the LoFreq tool is a single new file in your history in the <a href="http://www.internationalgenome.org/wiki/Analysis/vcf4.0/"><strong>vcf</strong></a> file format where each line describes a single variant. In Galaxy you can then directly see how many variants you have; often well over 1000 in total. Note the 17 comment-lines at the top of the file.</p>
<p>When looking at this file in more detail it is fairly easy to see variants in places we are not interested in. As you’ve seen in IGV, many regions have been sequenced outside of our genes of interest, or even very far from a gene at all. LoFreq also checked those regions for variants and this assignment asks to filter the list of variants only keeping those within exon boundaries of our genes of interest. Then, another filtering step is filtering on actual variants. We do this by looking at the <a href="https://en.wikipedia.org/wiki/Allele_frequency">allele frequency</a> value included in the VCF file. In our case, this value describes the percentage of reads having the <strong>variant</strong> base.</p>
<div id="assignment-8-vcf-file-processing" class="section level3" number="5.2.1">
<h3>
<span class="header-section-number">5.2.1</span> Assignment 8; VCF File Processing<a class="anchor" aria-label="anchor" href="#assignment-8-vcf-file-processing"><i class="fas fa-link"></i></a>
</h3>
<p>Please briefly read the linked Wikipedia page to understand why this value is of importance. As we are working with patient data, we use the protocol as described by the UMCG that states that variants with a minimum frequency of <strong>30%</strong> are retained. This means we will filter out any variants with a <em>lower</em> value. Note that LoFreq stores this value as a fraction so we filter for values <span class="math inline">\(&gt;= 0.3\)</span>.</p>
<p>There are once again step-by-step instructions for completing this assignment. It is however possible to do it without these instructions as we partly repeat steps we’ve taken in the previous assignments.</p>
<ol style="list-style-type: decimal">
<li>Read in the data into a data-frame using the <code>read.delim</code> function
<ul>
<li>Make sure the data has a proper header (line 18 in the data)</li>
<li>Provide the <code>stringsAsFactors = FALSE</code> argument, otherwise the next part won’t work (we cannot split an R <code>factor</code>)</li>
</ul>
</li>
</ol>
<p>Now that we have the data in a data-frame, inspect that everything is loaded correctly. The first thing that we’ll do now is get the frequency value for each variant. Read the comment lines in the VCF file to see how this value is stored. You’ll see that the columns themselves contain more fields, separated by a semicolon (<code>;</code>) which we can use to <em>split</em> the data to get to the value we want.</p>
<ol start="2" style="list-style-type: decimal">
<li>Split the column containing the frequency value using the <code>strsplit</code> function</li>
</ol>
<p>The output of this function is a list in which each item is a vector with the separate items resulting from the split (inspect this object in RStudio). To get the frequency value from this list, here is some R magic that converts the result from <code>strsplit</code> into a matrix (found on <a href="https://stackoverflow.com/questions/20428742/select-first-element-of-nested-list">Stackoverflow</a>):</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">bed_splitted</span><span class="op">)</span>, n<span class="op">=</span><span class="fl">20</span><span class="op">)</span></span></code></pre></div>
<pre><code>##           chromosome    begin      end  gene
## ABCC9.814         12 21953958 21954135 ABCC9
## ABCC9.815         12 21958088 21958265 ABCC9
## ABCC9.816         12 21958912 21959014 ABCC9
## ABCC9.817         12 21960260 21960433 ABCC9
## ABCC9.818         12 21962766 21962909 ABCC9
## ABCC9.819         12 21964963 21965111 ABCC9
## ABCC9.820         12 21967558 21967676 ABCC9
## ABCC9.821         12 21968677 21968847 ABCC9
## ABCC9.822         12 21970101 21970261 ABCC9
## ABCC9.823         12 21971064 21971205 ABCC9
## ABCC9.824         12 21981872 21982014 ABCC9
## ABCC9.825         12 21990992 21991124 ABCC9
## ABCC9.826         12 21995228 21995425 ABCC9
## ABCC9.827         12 21997397 21997506 ABCC9
## ABCC9.828         12 21997681 21997869 ABCC9
## ABCC9.829         12 21998517 21998786 ABCC9
## ABCC9.830         12 22001064 22001200 ABCC9
## ABCC9.831         12 22005011 22005176 ABCC9
## ABCC9.832         12 22005282 22005459 ABCC9
## ABCC9.833         12 22012500 22012620 ABCC9</code></pre>
<p>What it does is <code>rbind</code>s all vectors into a matrix. Again, inspect this object to see where the actual value is located that you want (use the <code>View</code> function in RStudio or click on the name in the <code>Environment</code> tab).</p>
<ol start="3" style="list-style-type: decimal">
<li>Perform the following steps on the column containing the frequency value:
<ul>
<li>remove the <code>AF=</code> part using the <code>gsub</code> function</li>
<li>converts the data type of this column to <code>numeric</code>
</li>
<li>saves only this column into a new variable</li>
</ul>
</li>
</ol>
<p>We now have the frequency value available for filtering and we’ll do that by adding it to the <code>GRanges</code> object we create next:</p>
<ol start="4" style="list-style-type: decimal">
<li>Create a <code>GRanges</code> object as we’ve done for assignment 3 by simply creating an <code>IRanges</code> object where the <code>start</code> and <code>end</code> parameters both get the variant position column (<code>POS</code> column). Also provide the <code>seqnames</code> parameter to <code>GRanges</code> which get the contents of the chromosome column. Note that we do not need to use a <code>for</code>-loop for this.</li>
</ol>
<p><code>GRanges</code> objects can contain other data as well, called <em>associated metadata</em>. Using the <code>mcols</code> function we can see existing or assign data to each variant. Adding this as a data-frame allows us to set a name for this column as demonstrated below with an example from the previous chapter:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Select and show data for a single gene (note that it specifies "... and 0 metadata columns")</span></span>
<span><span class="co"># ('granges' object is used from assignment 3)</span></span>
<span><span class="va">granges</span></span></code></pre></div>
<pre><code>## GRanges object with 5 ranges and 0 metadata columns:
##        seqnames              ranges strand
##           &lt;Rle&gt;           &lt;IRanges&gt;  &lt;Rle&gt;
##   SOD2        6 160103505-160103690      *
##   SOD2        6 160105866-160106085      *
##   SOD2        6 160109138-160109294      *
##   SOD2        6 160113673-160113915      *
##   SOD2        6 160114157-160114219      *
##   -------
##   seqinfo: 18 sequences from an unspecified genome; no seqlengths</code></pre>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate some random values for 'allele frequency'</span></span>
<span><span class="va">allele_frequency</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">5</span>, mean <span class="op">=</span> <span class="fl">0.45</span>, sd <span class="op">=</span> <span class="fl">0.35</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Bind this data to the 'GRanges' object</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">mcols</a></span><span class="op">(</span><span class="va">granges</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/DataFrame-class.html">DataFrame</a></span><span class="op">(</span>AF<span class="op">=</span><span class="va">allele_frequency</span><span class="op">)</span></span>
<span></span>
<span><span class="va">granges</span></span></code></pre></div>
<pre><code>## GRanges object with 5 ranges and 1 metadata column:
##        seqnames              ranges strand |        AF
##           &lt;Rle&gt;           &lt;IRanges&gt;  &lt;Rle&gt; | &lt;numeric&gt;
##   SOD2        6 160103505-160103690      * |       0.6
##   SOD2        6 160105866-160106085      * |       0.5
##   SOD2        6 160109138-160109294      * |       1.2
##   SOD2        6 160113673-160113915      * |       0.2
##   SOD2        6 160114157-160114219      * |       0.6
##   -------
##   seqinfo: 18 sequences from an unspecified genome; no seqlengths</code></pre>
<p>Use the example above to associate the frequency value with the created <code>GRanges</code> object. Now that we have both the BED-data (in a <code>GRangesList</code> object) and the VCF data in a <code>GRanges</code> object, we can</p>
<ol start="5" style="list-style-type: decimal">
<li>Get all variants that fall within an exon
<ul>
<li>Use the <code>findOverlaps</code> function and store its output
<ul>
<li>this requires the <code>query</code> and <code>subject</code> parameters to be set to the <em>variants</em> and <em>BED</em>-<code>GrangesList</code> objects respectively</li>
</ul>
</li>
<li>Convert the output to a data-frame using the <code>DataFrame</code> function</li>
</ul>
</li>
</ol>
<p>The result from <code>findOverlaps</code> contains two columns of which we are interested in the <code>querytHits</code> column; the rows from the VCF data that lie within an exon. You can use this column to subset the <code>GRanges</code> VCF object with. Note that the <code>subjectHits</code> column describes not the exons but the genes; meaning a subjectHit value of <code>1</code> refers to a hit within any of the first gene exons (<code>ABCC9</code> in case of the cardiopanel).</p>
<ol start="6" style="list-style-type: decimal">
<li>Filter the <strong>remaining</strong> variants based on their frequency, using a minimum of <strong>30%</strong>
<ul>
<li>Instead of removing rows or creating another subset, make sure you know which rows are to be kept after both filtering steps as we are going to reconstruct the original VCF file (we need it in Galaxy)</li>
<li>Manually sample a few rows to see if they do fall within an exon and have a frequency &gt; 30%</li>
</ul>
</li>
<li>Now that you have all the row numbers of variants that we want to keep, you need to think of a way to re-construct the VCF file and save it to disk.
<ul>
<li>Hint: read in the VCF file again for sub-setting using the <code>readLines</code> function</li>
<li>Note: do not forget to include the 17 header lines!</li>
</ul>
</li>
<li>Upload the new VCF file into Galaxy as we’ll use it in the next chapter.</li>
</ol>
</div>
<div id="assignment-9-variant-visualization" class="section level3" number="5.2.2">
<h3>
<span class="header-section-number">5.2.2</span> Assignment 9; Variant Visualization<a class="anchor" aria-label="anchor" href="#assignment-9-variant-visualization"><i class="fas fa-link"></i></a>
</h3>
<p>We will create two simple visualizations:</p>
<ul>
<li>Visualize the <strong>allele frequency</strong> for all remaining variants using the <code>hist</code> function. Remember that you can use the <code>mcols</code> function to get a metadata column or use the <code>$</code>-sign and the name of the column. Pass the argument <code>breaks=20</code> to <code>hist</code> and answer the following question in your lab-journal:
<ul>
<li>Can you explain the two peaks that you see in your histogram (around 50% and 100%)?</li>
</ul>
</li>
<li>Visualize the amount of variants per gene. A simple solution for getting the numbers is to use the <code>table</code> function on the <code>subjectHits</code> column (output of <code>findOverlaps</code> where <code>subject</code> are the <em>genes</em>). Convert it to a data frame and then use the gene indices to get the actual gene names. Now you should have a combination of gene and number of variants. Create a barplot with this data as in the previous chapter and use <code>cex.names=0.7</code> to scale the gene names to make them all visible.</li>
</ul>
<p>It is also possible to add the VCF file to IGV (together with the mapping- and BED-files) and visualize the variants in the context of the genes. This is however not a requirement for this assignment.</p>
<div class="inline-figure"><img src="images/igvVariant.png" width="311"></div>

</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="mapping-qc.html"><span class="header-section-number">4</span> Mapping Quality Control</a></div>
<div class="next"><a href="variant-annotation.html"><span class="header-section-number">6</span> Variant Annotation</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#variant-calling"><span class="header-section-number">5</span> Analysis of Variants</a></li>
<li><a class="nav-link" href="#variants"><span class="header-section-number">5.1</span> Finding and Annotating Variants</a></li>
<li>
<a class="nav-link" href="#variant-filtering"><span class="header-section-number">5.2</span> VCF File Filtering</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#assignment-8-vcf-file-processing"><span class="header-section-number">5.2.1</span> Assignment 8; VCF File Processing</a></li>
<li><a class="nav-link" href="#assignment-9-variant-visualization"><span class="header-section-number">5.2.2</span> Assignment 9; Variant Visualization</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/rwedema/NGS-Genetics//blob/master/05-variant_calling.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/rwedema/NGS-Genetics//edit/master/05-variant_calling.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Minor DSLS - Genomics Project</strong>" was written by Marcel Kempenaar and Ronald Wedema. It was last built on 2025-02-12.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
