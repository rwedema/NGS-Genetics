<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Week 3 Analysis of Variants | Case background information and exercises</title>
  <meta name="description" content="This is the background and assignments needed to complete module 2.1.1" />
  <meta name="generator" content="bookdown 0.40 and GitBook 2.6.7" />

  <meta property="og:title" content="Week 3 Analysis of Variants | Case background information and exercises" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is the background and assignments needed to complete module 2.1.1" />
  <meta name="github-repo" content="https://github.com/rwedema/NGS-Genetics/" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Week 3 Analysis of Variants | Case background information and exercises" />
  
  <meta name="twitter:description" content="This is the background and assignments needed to complete module 2.1.1" />
  

<meta name="author" content="Marcel Kempenaar and Ronald Wedema" />


<meta name="date" content="2024-09-03" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="mapping.html"/>
<link rel="next" href="variants.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>About</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#usage"><i class="fa fa-check"></i>Usage</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#learning-outcomes"><i class="fa fa-check"></i>Learning outcomes</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#end-products"><i class="fa fa-check"></i>End Products</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#rubric"><i class="fa fa-check"></i>Rubric</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#schedule-and-deliverables"><i class="fa fa-check"></i>Schedule and deliverables</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Intro <em>NGS and Genetics</em> Project</a>
<ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#cardiomyopathy"><i class="fa fa-check"></i><b>1.1</b> Cardiomyopathy</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#medulloblastoma"><i class="fa fa-check"></i><b>1.2</b> Medulloblastoma</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#tools"><i class="fa fa-check"></i><b>1.3</b> Tools</a></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#data"><i class="fa fa-check"></i><b>1.4</b> Data</a></li>
<li class="chapter" data-level="1.5" data-path="intro.html"><a href="intro.html#analysis"><i class="fa fa-check"></i><b>1.5</b> Analysis</a></li>
<li class="chapter" data-level="1.6" data-path="intro.html"><a href="intro.html#literature"><i class="fa fa-check"></i><b>1.6</b> Literature</a></li>
<li class="chapter" data-level="1.7" data-path="intro.html"><a href="intro.html#reporting"><i class="fa fa-check"></i><b>1.7</b> Reporting</a>
<ul>
<li class="chapter" data-level="1.7.1" data-path="intro.html"><a href="intro.html#galaxy-server"><i class="fa fa-check"></i><b>1.7.1</b> Galaxy Server</a></li>
<li class="chapter" data-level="1.7.2" data-path="intro.html"><a href="intro.html#data-and-quality-control"><i class="fa fa-check"></i><b>1.7.2</b> Data and quality control</a></li>
<li class="chapter" data-level="1.7.3" data-path="intro.html"><a href="intro.html#fastq-format"><i class="fa fa-check"></i><b>1.7.3</b> FASTQ format</a></li>
<li class="chapter" data-level="1.7.4" data-path="intro.html"><a href="intro.html#quality-control"><i class="fa fa-check"></i><b>1.7.4</b> Quality Control</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="mapping.html"><a href="mapping.html"><i class="fa fa-check"></i><b>2</b> Read Mapping</a>
<ul>
<li class="chapter" data-level="" data-path="mapping.html"><a href="mapping.html#mapping-with-bwa"><i class="fa fa-check"></i>Mapping with BWA</a></li>
<li class="chapter" data-level="2.1" data-path="mapping.html"><a href="mapping.html#assignment-week-2"><i class="fa fa-check"></i><b>2.1</b> Assignment week 2</a></li>
<li class="chapter" data-level="2.2" data-path="mapping.html"><a href="mapping.html#marking-duplicate-mapped-reads"><i class="fa fa-check"></i><b>2.2</b> Marking Duplicate Mapped Reads</a></li>
<li class="chapter" data-level="2.3" data-path="mapping.html"><a href="mapping.html#visualizing-the-mapping-data"><i class="fa fa-check"></i><b>2.3</b> Visualizing the Mapping Data</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="pileup.html"><a href="pileup.html"><i class="fa fa-check"></i><b>3</b> Analysis of Variants</a>
<ul>
<li class="chapter" data-level="3.1" data-path="pileup.html"><a href="pileup.html#assignment-week-3"><i class="fa fa-check"></i><b>3.1</b> Assignment week 3</a>
<ul>
<li class="chapter" data-level="" data-path="pileup.html"><a href="pileup.html#programming-assignments-coverage-overview-for-panel-genes"><i class="fa fa-check"></i>Programming Assignments; Coverage Overview for Panel Genes</a></li>
<li class="chapter" data-level="" data-path="pileup.html"><a href="pileup.html#assignment-instructions"><i class="fa fa-check"></i>Assignment Instructions</a></li>
<li class="chapter" data-level="3.1.1" data-path="pileup.html"><a href="pileup.html#assignment-1-loading-the-bed-data"><i class="fa fa-check"></i><b>3.1.1</b> Assignment 1; Loading the BED-data</a></li>
<li class="chapter" data-level="3.1.2" data-path="pileup.html"><a href="pileup.html#assignment-2-bed-visualization"><i class="fa fa-check"></i><b>3.1.2</b> Assignment 2; BED-visualization</a></li>
<li class="chapter" data-level="3.1.3" data-path="pileup.html"><a href="pileup.html#assignment-3-bioconductor"><i class="fa fa-check"></i><b>3.1.3</b> Assignment 3; Bioconductor</a></li>
<li class="chapter" data-level="3.1.4" data-path="pileup.html"><a href="pileup.html#assignment-4-gene-lengths"><i class="fa fa-check"></i><b>3.1.4</b> Assignment 4; Gene Lengths</a></li>
<li class="chapter" data-level="3.1.5" data-path="pileup.html"><a href="pileup.html#assignment-5-loading-the-mapped-reads"><i class="fa fa-check"></i><b>3.1.5</b> Assignment 5; Loading the Mapped Reads</a></li>
<li class="chapter" data-level="3.1.6" data-path="pileup.html"><a href="pileup.html#assignment-6-pileup-processing"><i class="fa fa-check"></i><b>3.1.6</b> Assignment 6; Pileup Processing</a></li>
<li class="chapter" data-level="3.1.7" data-path="pileup.html"><a href="pileup.html#assignment-7-coverage-calculation-and-reporting"><i class="fa fa-check"></i><b>3.1.7</b> Assignment 7; Coverage calculation and reporting</a></li>
<li class="chapter" data-level="" data-path="pileup.html"><a href="pileup.html#end-result"><i class="fa fa-check"></i>End Result</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="variants.html"><a href="variants.html"><i class="fa fa-check"></i><b>4</b> Finding and Annotating Variants</a>
<ul>
<li class="chapter" data-level="" data-path="variants.html"><a href="variants.html#finding-variants"><i class="fa fa-check"></i>Finding Variants</a>
<ul>
<li class="chapter" data-level="" data-path="variants.html"><a href="variants.html#vcf-file-filtering"><i class="fa fa-check"></i>VCF File Filtering</a></li>
<li class="chapter" data-level="4.0.1" data-path="variants.html"><a href="variants.html#assignment-8-vcf-file-processing"><i class="fa fa-check"></i><b>4.0.1</b> Assignment 8; VCF File Processing</a></li>
<li class="chapter" data-level="4.0.2" data-path="variants.html"><a href="variants.html#assignment-9-variant-visualization"><i class="fa fa-check"></i><b>4.0.2</b> Assignment 9; Variant Visualization</a></li>
</ul></li>
<li class="chapter" data-level="4.1" data-path="variants.html"><a href="variants.html#variant-annotation"><i class="fa fa-check"></i><b>4.1</b> Variant Annotation</a></li>
<li class="chapter" data-level="4.2" data-path="variants.html"><a href="variants.html#snpeff-and-snpsift"><i class="fa fa-check"></i><b>4.2</b> SnpEff and SnpSift</a>
<ul>
<li class="chapter" data-level="" data-path="variants.html"><a href="variants.html#assignment"><i class="fa fa-check"></i>Assignment</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="variants.html"><a href="variants.html#programming-assignment-analyzing-variant-annotation"><i class="fa fa-check"></i><b>4.3</b> Programming Assignment; Analyzing Variant Annotation</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="variants.html"><a href="variants.html#assignment-10-data-preparation"><i class="fa fa-check"></i><b>4.3.1</b> Assignment 10; Data Preparation</a></li>
<li class="chapter" data-level="4.3.2" data-path="variants.html"><a href="variants.html#assignment-11-finding-variants-of-interest"><i class="fa fa-check"></i><b>4.3.2</b> Assignment 11; Finding Variants of Interest</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="presentation.html"><a href="presentation.html"><i class="fa fa-check"></i><b>5</b> Presentation</a>
<ul>
<li class="chapter" data-level="5.1" data-path="presentation.html"><a href="presentation.html#galaxy-workflow"><i class="fa fa-check"></i><b>5.1</b> Galaxy Workflow</a></li>
<li class="chapter" data-level="5.2" data-path="presentation.html"><a href="presentation.html#comparative-genomics-optional"><i class="fa fa-check"></i><b>5.2</b> Comparative Genomics [OPTIONAL]</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Case background information and exercises</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="pileup" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">Week 3</span> Analysis of Variants<a href="pileup.html#pileup" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Once we are done with mapping all reads to the reference genome, we can determine the variant positions within the genes of interest. For this we use a Galaxy tool called <em>LoFreq</em> that will report on found variants and their statistics such as allele frequency, number of supported reads, average base quality at the found position, etc.</p>
<p>Before finding the actual variants, we will perform analysis assessing the achieved coverage. As you might have seen in IGV, coverages range from very high numbers (300+) to places where there are only a few reads present. In this chapter we will use R with a number of libraries often used for genetics research to report on these numbers for all panel genes.</p>
<div id="assignment-week-3" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Assignment week 3<a href="pileup.html#assignment-week-3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="programming-assignments-coverage-overview-for-panel-genes" class="section level3 unnumbered hasAnchor">
<h3>Programming Assignments; Coverage Overview for Panel Genes<a href="pileup.html#programming-assignments-coverage-overview-for-panel-genes" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Within the output of the previous mapping step (the BAM file) we can see how (well) our panel-genes are covered by our reads, a very important statistic on the quality of our data. We could assess this manually using IGV, but that is definitely not the method to use for such a task given that there can be 1-2000+ mapped exons in total. This section contains a number of small assignments that - once completed - will give us a clear indication whether our mapping is of sufficient quality. Depending on this outcome we might need to revisit our previous step(s) such as the trimming process to increase our mapping quality.</p>
<p>During these assignments we will gain insight into the coverage of all of our genes of interest as well as their variants. We will use the BED-file describing the locations of all exons, the BAM file containing the mapped reads and - which we’ll create later - a VCF-file listing all found variants. A number of assignments asks to visualize the results to get a good understanding of what we’re looking at.</p>
</div>
<div id="assignment-instructions" class="section level3 unnumbered hasAnchor">
<h3>Assignment Instructions<a href="pileup.html#assignment-instructions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Below are a number assignments that together perform the tasks as explained above. For each you are required to <strong>carefully read the instructions</strong> and make sure you understand the goal and data used for that particular assignment. Being able to <strong>critically reflect</strong> on the outcome of your analysis is the most important aspect of being a bioinformatician! Furthermore, these assignments are generally a guideline and while it should be considered the minimum tasks to complete, you are always invited to do <em>more</em> with the data that you have. Feel free to explore and keep that code in your lab-journal as
well.</p>
<p>To perform some of these tasks we do need to learn some theory that is specific for working with our data (BED and Pileup files among others). For that we will introduce the Bioconductor libraries later on. First though we will explore the most simple of our data files and create a few simple plots based on the BED data.</p>
<p>For each of these assignments, create at least one code-chunk, name it accordingly and in between the assignments reflect on what you did. For instance as the end product of assignment one is a data frame with a proper header and an overview plot of the number of exons per chromosome, you could end this assignment by stating <em>“After loading and processing the data, the overview shows all chromosomes on which exons are located for the panel genes”</em>.</p>
</div>
<div id="assignment-1-loading-the-bed-data" class="section level3 hasAnchor" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> Assignment 1; Loading the BED-data<a href="pileup.html#assignment-1-loading-the-bed-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The first step of our program is to read the BED file to get the exon locations for our panel genes. We already viewed the contents of the BED file in Galaxy, where we saw that this file contains 4 columns:</p>
<ul>
<li>The chromosome number,</li>
<li>exon start location,</li>
<li>exon end location and the</li>
<li>gene name</li>
</ul>
<p>For example:</p>
<pre><code>10  75399683    75399795    MYOZ1   
10  75757946    75758153    VCL   
10  75802821    75802931    VCL</code></pre>
<p>Perform these tasks:</p>
<ol style="list-style-type: decimal">
<li>Load the BED-data
<ul>
<li>Since this data is stored in a text file using tabs as column
separators, we can easily read this in using the <code>read.table</code>
function.</li>
</ul></li>
<li>Change the column names
<ul>
<li>There are no column names in the BED-file and <code>read.table</code> gives
default names in this case: <code>[1] "V1" "V2" "V3" "V4"</code>. Using the
<code>names</code> function, we can assign new column names, do this by
assigning a vector with four column names (see the help of
<code>names</code>)</li>
</ul></li>
<li>Print the number of exons per chromosome
<ul>
<li>An easy way to get an overview of large amounts of data (only
1204 exons in this case) is by using the <code>table</code> function. Using
this function, show the number of exons per chromosome.</li>
</ul></li>
<li>Plot the number of exons per chromosome
<ul>
<li>The data from (3) can be used to create a plot by giving it to
the <code>barplot</code> function. Change the label on the y-axis to
something meaningful. Since the chromosome numbers can’t all fit
on the x-axis you can change its orientation using the <code>las = 2</code>
argument to <code>barplot</code>. Further options aren’t necessary and the
plot doesn’t have to be very pretty at this stage.</li>
</ul></li>
</ol>
</div>
<div id="assignment-2-bed-visualization" class="section level3 hasAnchor" number="3.1.2">
<h3><span class="header-section-number">3.1.2</span> Assignment 2; BED-visualization<a href="pileup.html#assignment-2-bed-visualization" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ol style="list-style-type: decimal">
<li>Visualize the number of genes per chromosome
<ul>
<li>This requires the creation of a subset of unique chromosome-gene
combinations; all genes consist of exons but if we reduce all
genes to a single exon (doesn’t matter which), we can then use
the <code>table</code> function again to give us the numbers that we need.</li>
<li>Select only the ‘chromosome’ and ‘gene’ columns (using the names
that you gave in assignment 1.2) from the BED-data</li>
<li>Apply the <code>unique</code> function to reduce this data to a single row
per gene and store only the ‘chromosome’ column of the result</li>
<li>Give this data to <code>table</code> and use that result as input for the
<code>barplot</code> function using a proper label for the y-axis.</li>
</ul></li>
</ol>
</div>
<div id="assignment-3-bioconductor" class="section level3 hasAnchor" number="3.1.3">
<h3><span class="header-section-number">3.1.3</span> Assignment 3; Bioconductor<a href="pileup.html#assignment-3-bioconductor" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>As software developers develop algorithms or solutions for common
problems, they would like to publish their code so that others can use
it too. For R (and many other programming languages) this code is
packaged in a <em>library</em> that can then be easily distributed to others.
You might already be familiar with the <code>library()</code> function in R to load
external code into your environment and that is what we will do here
too.</p>
<p><a href="http://bioconductor.org">Bioconductor</a> is a <em>repository</em> that contains
over 1800 of these libraries that we can get into R and use to perform
analysis with. This vast amount of libraries are all focused on
analyzing, processing and visualizing (high-throughput) biological data
which we will also be using during both practical courses. Luckily you
don’t have to find the libraries yourself and the assignments will
always instruct on which one to use (to load actually, since they are
pre-installed on our network).</p>
<p>What we will introduce here is a concept that is required for most of
the remaining assignments below, namely <code>GenomicRanges</code> objects
(<a href="http://bioconductor.org/packages/release/bioc/html/GenomicRanges.html">website</a>,
<a href="http://bioconductor.org/packages/release/bioc/vignettes/GenomicRanges/inst/doc/GenomicRangesIntroduction.html">manual</a>),
consisting of <code>IRanges</code>
(<a href="http://bioconductor.org/packages/release/bioc/html/IRanges.html">website</a>,
<a href="http://bioconductor.org/packages/release/bioc/vignettes/IRanges/inst/doc/IRangesOverview.pdf">manual</a>)
objects. These ‘<em>objects</em>’ (they hold data in a combination of vectors,
lists and data frames among other data structures) are used to store
information about features on the genome. These features (introns,
exons, variants, etc.) are always defined by their coordinates such as
start and stop positions and the name of the sequence (in our case,
chromosome) on which they lie.</p>
<p>The BED-file for instance can be represented using
<code>IRanges</code> since it contain simple positional data (chromosome
and position (start/ stop for BED-data). Let’s first see an example of representing a few exons from the BED file into <code>IRanges</code> objects (you don’t need to replicate this
example).</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="pileup.html#cb2-1" tabindex="-1"></a><span class="do">## Only needed when the package is missing</span></span>
<span id="cb2-2"><a href="pileup.html#cb2-2" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">&quot;BiocManager&quot;</span>))</span>
<span id="cb2-3"><a href="pileup.html#cb2-3" tabindex="-1"></a>    <span class="fu">install.packages</span>(<span class="st">&quot;BiocManager&quot;</span>)</span>
<span id="cb2-4"><a href="pileup.html#cb2-4" tabindex="-1"></a></span>
<span id="cb2-5"><a href="pileup.html#cb2-5" tabindex="-1"></a>BiocManager<span class="sc">::</span><span class="fu">install</span>(<span class="st">&quot;GenomicRanges&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="pileup.html#cb3-1" tabindex="-1"></a><span class="co"># This package contains the &#39;IRanges&#39;, &#39;GRanges&#39; and &#39;GRangesList&#39; classes we will use</span></span>
<span id="cb3-2"><a href="pileup.html#cb3-2" tabindex="-1"></a><span class="fu">library</span>(GenomicRanges)</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="pileup.html#cb4-1" tabindex="-1"></a><span class="co"># Loading the BED data (note: use your own data from assignment 1)</span></span>
<span id="cb4-2"><a href="pileup.html#cb4-2" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;data/bed_data.RData&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="pileup.html#cb5-1" tabindex="-1"></a><span class="co"># Print all rows where the gene name is for example &#39;SOD2&#39;</span></span>
<span id="cb5-2"><a href="pileup.html#cb5-2" tabindex="-1"></a>bed_file[bed_file<span class="sc">$</span>gene <span class="sc">==</span> <span class="st">&quot;SOD2&quot;</span>, ]</span></code></pre></div>
<pre><code>##     chromosome     begin       end gene
## 649          6 160103505 160103690 SOD2
## 650          6 160105866 160106085 SOD2
## 651          6 160109138 160109294 SOD2
## 652          6 160113673 160113915 SOD2
## 653          6 160114157 160114219 SOD2</code></pre>
<p>Shown above is a dataframe similar to your data containing the five
exons of the <code>SOD2</code> gene located on chromosome 6. For each exon we have
a begin and end coordinate. This data can be converted into <code>IRanges</code> by
using the similar named function and providing the correct columns as
shown below:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="pileup.html#cb7-1" tabindex="-1"></a><span class="co"># Get the data as a subset of the cardiopanel data</span></span>
<span id="cb7-2"><a href="pileup.html#cb7-2" tabindex="-1"></a>sod2 <span class="ot">&lt;-</span> bed_file[bed_file<span class="sc">$</span>gene <span class="sc">==</span> <span class="st">&quot;SOD2&quot;</span>, ]</span>
<span id="cb7-3"><a href="pileup.html#cb7-3" tabindex="-1"></a></span>
<span id="cb7-4"><a href="pileup.html#cb7-4" tabindex="-1"></a><span class="co"># Assign whole columns to the IRanges arguments</span></span>
<span id="cb7-5"><a href="pileup.html#cb7-5" tabindex="-1"></a>ranges <span class="ot">&lt;-</span> <span class="fu">IRanges</span>(<span class="at">start =</span> sod2<span class="sc">$</span>begin,</span>
<span id="cb7-6"><a href="pileup.html#cb7-6" tabindex="-1"></a>                  <span class="at">end =</span> sod2<span class="sc">$</span>end,</span>
<span id="cb7-7"><a href="pileup.html#cb7-7" tabindex="-1"></a>                  <span class="at">names =</span> sod2<span class="sc">$</span>gene)</span>
<span id="cb7-8"><a href="pileup.html#cb7-8" tabindex="-1"></a><span class="co"># Print the object</span></span>
<span id="cb7-9"><a href="pileup.html#cb7-9" tabindex="-1"></a>ranges</span></code></pre></div>
<pre><code>## IRanges object with 5 ranges and 0 metadata columns:
##            start       end     width
##        &lt;integer&gt; &lt;integer&gt; &lt;integer&gt;
##   SOD2 160103505 160103690       186
##   SOD2 160105866 160106085       220
##   SOD2 160109138 160109294       157
##   SOD2 160113673 160113915       243
##   SOD2 160114157 160114219        63</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="pileup.html#cb9-1" tabindex="-1"></a><span class="co"># Calculate and print the length of a gene</span></span>
<span id="cb9-2"><a href="pileup.html#cb9-2" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Length of SOD2:&quot;</span>, <span class="fu">sum</span>( <span class="fu">width</span>(ranges) ), <span class="st">&quot;bp&quot;</span>)</span></code></pre></div>
<pre><code>## Length of SOD2: 869 bp</code></pre>
<p>We see the same data now represented as an <code>IRanges</code> object. We do however both miss some data (the chromosome) and get some extra data as well (the <em>width</em> (length) of each exon). As it’s important to know on which chromosome each gene lies we will convert our <code>ranges</code> object into a <code>GRanges</code> object that combines both data:</p>
<pre><code>## GRanges object with 5 ranges and 0 metadata columns:
##        seqnames              ranges strand
##           &lt;Rle&gt;           &lt;IRanges&gt;  &lt;Rle&gt;
##   SOD2        6 160103505-160103690      *
##   SOD2        6 160105866-160106085      *
##   SOD2        6 160109138-160109294      *
##   SOD2        6 160113673-160113915      *
##   SOD2        6 160114157-160114219      *
##   -------
##   seqinfo: 18 sequences from an unspecified genome; no seqlengths</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="pileup.html#cb12-1" tabindex="-1"></a><span class="co"># Converts iRanges to GRanges, adding the chromosome name</span></span>
<span id="cb12-2"><a href="pileup.html#cb12-2" tabindex="-1"></a>granges <span class="ot">&lt;-</span> <span class="fu">GRanges</span>(<span class="at">seqnames =</span> sod2<span class="sc">$</span>chromosome,</span>
<span id="cb12-3"><a href="pileup.html#cb12-3" tabindex="-1"></a>                   <span class="at">ranges =</span> ranges)</span>
<span id="cb12-4"><a href="pileup.html#cb12-4" tabindex="-1"></a>granges</span></code></pre></div>
<p>When comparing the <code>IRanges</code> object with the <code>GRanges</code> object, it looks rather similar with yet again some missing data (the <em>width</em>) and some extra data (the <em>strand</em>). Nothing is lost though, as objects often have a lot of <em>accessor</em> methods that you can use for getting to the actual data, as the example above is a <em>representation</em> of the object that you get when you print it. Functions such as <code>width()</code> applied to an <code>IRanges</code> object gives the <code>width</code> column and the <code>ranges()</code> function applied to a <code>GRanges</code> object gives the <code>IRanges</code> object contained within. When needed, the assignments will hint to their usage but the linked manuals also describe the most important ones.</p>
<p>Now that we have a gene within a <code>GRanges</code> object, what can we do with it? For now with just the BED data not a lot, but as we will also put the Pileup data into a similar <code>GRanges</code> object, we can start asking our data interesting questions with the <code>pileup</code> function for instance. This can be used to get the Pileup information specific for our exons and ignoring everything else. But before we can do that we need to get our BED-data into the proper format first and that is what we will do now.</p>
<p>This more challenging assignment results in yet another type of object, named a <code>GRangesList</code> that contains multiple <code>GRanges</code> objects; one for each gene such as shown in the above example. So, in order to do that we need to:</p>
<ol style="list-style-type: decimal">
<li>Create an empty (standard) R list,</li>
<li>Iterate over all of our genes in the BED file,
<ul>
<li>Read the part about <code>iteration</code> below and</li>
<li>the hints about the <code>split</code> function to get the gene names and data easily accessible.</li>
</ul></li>
<li>For each gene, create a <code>GRanges</code> object and add it to the list, including the gene name (use the following form: <code>my_list[[gene_name]] &lt;- data</code>) and</li>
<li><em>Convert</em> the complete list into a <code>GRangesList</code> object.
<ul>
<li>Use the conversion as explained in the <code>GRanges</code> manual: <code>bed_data &lt;- GRangesList(bed_data)</code> given that the list is called <code>bed_data</code>.</li>
</ul></li>
</ol>
<p>The techniques required for this assignment are mainly knowing how to work with lists (including how to create them, accessing single elements, adding to lists and iterating over its items). The following hints, the numbered list above and the examples are everything you need to do this assignment.</p>
<p><strong>Hints and further instructions:</strong></p>
<p><strong>Iteration</strong></p>
<p>When we talk about iterating when programming, we mean repeatedly performing a set of operations on separate elements (of a vector, a list, columns or rows of a data-frame, etc.). In ordinary programming languages this often requires explicit step-wise execution of these operations, using constructs such as <code>for</code> and <code>while</code> ‘loops’. In R however, we already perform a lot of iterative steps without realizing it. Given a vector <code>x</code>, we can multiply each value with itself by simply stating <code>x * x</code>. Programming languages such as Python, Java and C require code like:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="pileup.html#cb13-1" tabindex="-1"></a>squared <span class="op">=</span> []</span>
<span id="cb13-2"><a href="pileup.html#cb13-2" tabindex="-1"></a><span class="cf">for</span> value <span class="kw">in</span> x:</span>
<span id="cb13-3"><a href="pileup.html#cb13-3" tabindex="-1"></a>    squared.append(value <span class="op">*</span> value)</span></code></pre></div>
<p>This is still pretty readable code, but in R we never require this explicit form even though we <em>could</em>. This simple one liner in R for instance calculates the average log2 ratio of two columns from a data-frame that can contain thousands of rows and many columns, at once:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="pileup.html#cb14-1" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">log2</span>(dat[<span class="st">&#39;sample1&#39;</span>], dat[<span class="st">&#39;sample2&#39;</span>]))</span></code></pre></div>
<p>which would require a rather large for-loop in most other languages. When we do want to apply something to each element separately in R we often use the - rather complicated but efficient - <code>apply</code> functions. For now though we will use the easier to understand <code>for</code> loop to perform our code on data for each gene (point 1 above). With the following example on iterating over our <code>bed_data</code> you should be able to perform this assignment:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="pileup.html#cb15-1" tabindex="-1"></a><span class="co"># Load the stored data; do not repeat. Object name in this</span></span>
<span id="cb15-2"><a href="pileup.html#cb15-2" tabindex="-1"></a><span class="co"># example is &#39;bed_data&#39; </span></span>
<span id="cb15-3"><a href="pileup.html#cb15-3" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&#39;data/bed_data_GRangesList.RData&#39;</span>)</span>
<span id="cb15-4"><a href="pileup.html#cb15-4" tabindex="-1"></a></span>
<span id="cb15-5"><a href="pileup.html#cb15-5" tabindex="-1"></a><span class="co"># Split the data by gene, resulting in a list with named elements</span></span>
<span id="cb15-6"><a href="pileup.html#cb15-6" tabindex="-1"></a>bed_splitted <span class="ot">&lt;-</span> <span class="fu">split</span>(bed_file, bed_file<span class="sc">$</span>gene)</span>
<span id="cb15-7"><a href="pileup.html#cb15-7" tabindex="-1"></a><span class="co"># Print the names of the first 10 genes</span></span>
<span id="cb15-8"><a href="pileup.html#cb15-8" tabindex="-1"></a><span class="cf">for</span> (gene <span class="cf">in</span> <span class="fu">names</span>(bed_splitted)[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]) {</span>
<span id="cb15-9"><a href="pileup.html#cb15-9" tabindex="-1"></a>    <span class="fu">print</span>(gene)</span>
<span id="cb15-10"><a href="pileup.html#cb15-10" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] &quot;ABCC9&quot;
## [1] &quot;ACTC1&quot;
## [1] &quot;ACTN2&quot;
## [1] &quot;ANKRD1&quot;
## [1] &quot;BAG3&quot;
## [1] &quot;CALR3&quot;
## [1] &quot;CAV3&quot;
## [1] &quot;CRYAB&quot;
## [1] &quot;CSRP3&quot;
## [1] &quot;DES&quot;</code></pre>
<p><strong>Hints</strong></p>
<ul>
<li>As point 2 asks to iterate over all genes, we need to think of a way to group our data (exons) into genes which can be done using the <code>split</code> function. The result of <code>split</code> is a list with 55 named elements; one for each gene.
<ul>
<li>The <code>split</code> function requires two arguments: first the data-frame containing all of the data and the second argument is the column containing the gene names (i.e. <code>bed_file$gene</code>)</li>
<li>You can get the gene names by executing the <code>names</code> function on the resulting list from <code>split</code>.</li>
<li>You can get all the exon-rows easily by accessing the list items: <code>split_output[[gene_name]]</code>.</li>
</ul></li>
<li>When iterating, the code that you execute for each gene could be (1) create an <code>IRanges</code> object, (2) create a <code>GRanges</code> object combining the chromosome with the <code>IRanges</code> object and finally appending this to a list.</li>
<li>Note that this requires an empty list to be created <em>before</em> the <code>for</code>-loop, such as <code>exons &lt;- list()</code>.</li>
</ul>
<p>Revisit everything you’ve written to complete this task and make sure you understand what everything does (the exact <em>how</em> it works is of less importance). Also, you can use functions like <code>class</code> and <code>elementType</code> to confirm that your list is of class <code>GRangesList</code> (actually a <code>CompressedGRangesList</code>) and its contents are of type <code>GRanges</code>.</p>
</div>
<div id="assignment-4-gene-lengths" class="section level3 hasAnchor" number="3.1.4">
<h3><span class="header-section-number">3.1.4</span> Assignment 4; Gene Lengths<a href="pileup.html#assignment-4-gene-lengths" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We’ll create one last visualization based on the BED-data - but now using the <code>GRanges</code> object - namely an overview of the gene lengths; another barplot. The following example code shows how to calculate the length of a single gene (using <code>ranges</code>, <code>width</code> and <code>sum</code>). The same code also works on the complete <code>GRangesList</code> object, use this to create a barplot showing the length of each gene.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="pileup.html#cb17-1" tabindex="-1"></a><span class="co"># Check the length (in basepairs) of a single gene (exons only)</span></span>
<span id="cb17-2"><a href="pileup.html#cb17-2" tabindex="-1"></a>psen2_ranges <span class="ot">&lt;-</span> <span class="fu">ranges</span>(bed_data[[<span class="st">&#39;PSEN2&#39;</span>]])</span>
<span id="cb17-3"><a href="pileup.html#cb17-3" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">&quot;Length of the &#39;PSEN2&#39; gene:&quot;</span>, <span class="fu">sum</span>(<span class="fu">width</span>(psen2_ranges)), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<p><strong>Hint:</strong></p>
<p>As you might see, there can be some genes which are very long compared to the others and this makes the plot difficult to read. The <code>plotrix</code> library contains the <code>gap.barplot</code> function specifically for this purpose (also supports the <code>las = 2</code> argument). Try to use this function for creating the barplot. As a small challenge you can try to style the y-axis to show more values (‘ticks’) besides the minimum and maximum.</p>
</div>
<div id="assignment-5-loading-the-mapped-reads" class="section level3 hasAnchor" number="3.1.5">
<h3><span class="header-section-number">3.1.5</span> Assignment 5; Loading the Mapped Reads<a href="pileup.html#assignment-5-loading-the-mapped-reads" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In R we will use the output of the <em>mapping</em> step (the BAM file) to inspect the coverage of all mapped positions of our panel genes. There is an R library that can read this data (<code>RSamtools</code> <a href="https://bioconductor.org/packages/release/bioc/html/Rsamtools.html">website</a> and <a href="https://bioconductor.org/packages/release/bioc/vignettes/Rsamtools/inst/doc/Rsamtools-Overview.pdf">manual</a>) into <code>GRanges</code> objects. We have already downloaded the data as it was the input for the IGV tool in the previous chapter.</p>
<div id="rsamtools" class="section level4 unnumbered hasAnchor">
<h4>Rsamtools<a href="pileup.html#rsamtools" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Again, we have to briefly introduce this library before you will be able to use it. Rsamtools is described as “<em>an interface to BAM files</em>”, the file that contains all the mapping information.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="pileup.html#cb18-1" tabindex="-1"></a><span class="co"># Installing required library</span></span>
<span id="cb18-2"><a href="pileup.html#cb18-2" tabindex="-1"></a>BiocManager<span class="sc">::</span><span class="fu">install</span>(<span class="st">&quot;Rsamtools&quot;</span>)</span>
<span id="cb18-3"><a href="pileup.html#cb18-3" tabindex="-1"></a></span>
<span id="cb18-4"><a href="pileup.html#cb18-4" tabindex="-1"></a><span class="co"># Loading the RSamtools library</span></span>
<span id="cb18-5"><a href="pileup.html#cb18-5" tabindex="-1"></a><span class="fu">library</span>(Rsamtools)</span></code></pre></div>
<p>Functions from <code>Rsamtools</code> that we will use - in order - are:</p>
<ul>
<li><code>BamFile</code>: Reference to the BAM data and its index (<code>.bam.bai</code>)</li>
<li><code>ScanBamParam</code>: Sets the <em>parameters</em> for selecting a certain region from the genome using <code>GRanges</code> (i.e., a gene from our BED-data)</li>
<li><code>pileup</code>: Actually retrieves the region of interest given the <code>BamFile</code> and parameters supplied.</li>
</ul>
<p><strong>Assignment</strong>:</p>
<ul>
<li>Load the BAM mapping data into a list of data-frames covering all mapped positions of interest</li>
</ul>
</div>
<div id="instructions" class="section level4 unnumbered hasAnchor">
<h4>Instructions<a href="pileup.html#instructions" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li><p>Create a <code>BamFile</code> object by providing both the <code>file</code> and <code>index</code> parameters</p></li>
<li><p>Create a <code>ScanBamParam</code> object</p>
<ul>
<li>What this does is defining all the ranges that we want to get from the mapping, in this case the ranges of all exons for a gene</li>
<li>Do this by selecting a single gene from your <code>GRangesList</code> object (using the <code>[["geneName"]]</code> syntax) and store this in an object (it’s type will be a <code>GRanges</code>)</li>
<li>Give this <code>GRanges</code> object to the <code>ScanBamParam</code> function and store this in a variable</li>
</ul></li>
<li><p>Get the actual mapping data for our region of interest</p>
<ul>
<li>Call the <code>pileup</code> function providing - in order - the objects created at points 1-2. Note that you need to tell <code>pileup</code> what the parameter is, so use <code>pileup(file = ..., scanBamParam = ...)</code></li>
<li>The output of the <code>pileup</code> function is a data-frame, store this result</li>
<li>Print the first lines of the data-frame (use the <code>head</code> function)</li>
</ul></li>
</ol>
<div class="rmdnote">
<p>The mention of <code>pileup</code> in this assignment means looking at a single genomic position like we’ve seen in IGV. There are tools available to generate a <em>pileup</em> file from a BAM file (file format description <a href="http://samtools.sourceforge.net/pileup.shtml">available
here</a> and
<a href="https://en.wikipedia.org/wiki/Pileup_format">here</a>) containing the following information for <strong>all</strong> mapped positions:</p>
<ul>
<li>the chromosome name (1)</li>
<li>reference position (2),</li>
<li>reference base (3),</li>
<li>number of supporting reads (4),</li>
<li>the match (5), either:
<ul>
<li>a dot for a match in the forward strand or</li>
<li>a comma for a match in the reverse strand</li>
<li>a nucleotide in case of a mismatch (upper case for the forward
strand, lower case for the reverse strand)</li>
<li>insertions/ deletions (defined by a <code>+</code> or <code>-</code> sign followed by
a number defining the size of the insert/ deletion, followed by
the bases that form the insert/ deletion).</li>
</ul></li>
<li>the quality [6] (taken from the FASTQ file) can be seen in the last
column, one value for each read</li>
</ul>
<pre><code>  1          2   3    4   5     6
chr1     10004   c    1   ,     [ 
chr1     10005   g    3   ,,.   ?1&gt;</code></pre>
<p>The reason this format is called <em>pileup</em> is because for each <em>position</em>
it will pile (or stack) the data from all mapped reads for that
position. In the first example line above (chromosome 1, position 10004)
there was only one read with a match (the reference is a C as shown in
column 3) in the reverse strand and the second line has three supporting
reads with a match.</p>
<p>The line below is an example where multiple reads (30 in total, as shown
in column 4 and by the lengths of columns 5 and 6) mapped on a single
position. Here on chromosome 1 we see that in column 5 there is
something going on. Read 8 contained a <code>C</code> whereas the reference (and
the other 29 reads) show a <code>T</code> at this position, so this is classified
as a mismatch which will be the subject of further analysis steps.</p>
<pre><code>chr1    16888646    T   30  .......C........,.,.....,,....  WomHHGomooHmHFHHGGFH1GDHHHHGFF</code></pre>
<p>Besides mismatches, we can also have <em>insertions</em> and <em>deletions</em> such
as shown in the example below with a <code>-</code> sign followed by a number and a
number of bases that are missing.</p>
<pre><code>chr1    16888710    a   31  ..,.,..,..,,-2ct,,..,.,,.-2CT,,.,,.,.,, nGFkGUlFF?DFHFGGEnHFFHHGFHG5GGB</code></pre>
</div>
<p>Look at the data that we get for each position and note that we have - at least - two rows of data per position; one on each strand (as we’ve also seen in IGV). If we have <em>more</em> than two rows of data for a single position, it might be a variant which is coincidentally demonstrated in the example data below:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="pileup.html#cb22-1" tabindex="-1"></a><span class="co"># Load the example Pileup data for the SOD2 gene (do not repeat)</span></span>
<span id="cb22-2"><a href="pileup.html#cb22-2" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;data/sod2_pileup.RData&quot;</span>)</span>
<span id="cb22-3"><a href="pileup.html#cb22-3" tabindex="-1"></a><span class="fu">head</span>(sod2, <span class="at">n =</span> <span class="dv">5</span>)</span></code></pre></div>
<pre><code>##   seqnames       pos strand nucleotide count              which_label
## 1     chr6 160103505      +          C   221 chr6:160103505-160103690
## 2     chr6 160103505      -          C    77 chr6:160103505-160103690
## 3     chr6 160103505      +          T     1 chr6:160103505-160103690
## 4     chr6 160103506      +          T   220 chr6:160103505-160103690
## 5     chr6 160103506      -          T    77 chr6:160103505-160103690</code></pre>
<p>The first position of the SOD2 gene in this case shows three rows; two on the positive strand and one on the negative strand. The <code>count</code> column shows that there is a single read that has a <code>T</code> nucleotide at this position instead of a <code>C</code> that the other 297 reads show. With such a big difference, this can be attributed to a sequencing error.</p>
<p>Note though that what we have now is a <em>summary</em> of the actual pileup compared to the very detailed line we see in the actual Pileup file within Galaxy. This data is also available using <code>RSamtools</code> but we only require this summary.</p>
</div>
</div>
<div id="assignment-6-pileup-processing" class="section level3 hasAnchor" number="3.1.6">
<h3><span class="header-section-number">3.1.6</span> Assignment 6; Pileup Processing<a href="pileup.html#assignment-6-pileup-processing" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In this assignment we will get the pileup data for all of our genes into a single object so that we can report on the average coverage of each gene and determine if there are positions with a low coverage that we might need to inspect, more on that later.</p>
<p>Steps that need to be taken:</p>
<ol style="list-style-type: decimal">
<li>Create an empty list (this will hold a separate data-frame for each gene as created in assignment 5)</li>
<li>Iterate over your BED-data (the <code>GRangesList</code> object) similar as we did in assignment 3</li>
<li>Get the pileup data for each gene in the for-loop, by creating a <code>ScanBamParam</code> and executing the <code>pileup</code> function</li>
<li>Add the resulting pileup data-frame to the list, using it’s gene name as identifier (<code>pileup_list[[gene_name]] &lt;- ...</code>)</li>
<li>Check by printing the <code>head</code> again for the same gene as used in assignment 5</li>
</ol>
</div>
<div id="assignment-7-coverage-calculation-and-reporting" class="section level3 hasAnchor" number="3.1.7">
<h3><span class="header-section-number">3.1.7</span> Assignment 7; Coverage calculation and reporting<a href="pileup.html#assignment-7-coverage-calculation-and-reporting" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Calculating the actual coverage for each position is a little cumbersome as we need to sum the count of all rows for a single position since we don’t - yet - care about mismatches or the strand a read is mapped on.</p>
<p>Instead of performing all kinds of programming steps to check if positions are similar and if so, summing the count values, we can use an R function to do this for us. We don’t expect you to understand the following example besides understanding what it produces. This summation can done by a function called <code>aggregate</code>, defined as “<em>Compute Summary Statistics of Data Subsets</em>”.</p>
<p>Given a column to group on (our <code>pos</code> column) it will perform a function on a different column (our <code>count</code> column containing the coverage. The result of aggregate is a two-column data-frame with the position and the sum of all count values for this position; the total coverage.</p>
<p>We provide the arguments as follows:</p>
<ul>
<li><code>x</code>: the <code>count</code> column (we provide it as a list so it gets a name in the resulting data-frame as well)</li>
<li><code>by</code>: the <code>pos</code> column the grouping is applied to</li>
<li><code>FUN</code>: the function to perform on all grouped rows (in this case, the <code>sum</code> function)</li>
</ul>
<p>Use the code below but check and rename the used variables to suit your data.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="pileup.html#cb24-1" tabindex="-1"></a>coverage <span class="ot">=</span> <span class="fu">aggregate</span>(<span class="at">x =</span> <span class="fu">list</span>(<span class="at">count=</span>sod2<span class="sc">$</span>count), </span>
<span id="cb24-2"><a href="pileup.html#cb24-2" tabindex="-1"></a>                     <span class="at">by =</span> <span class="fu">list</span>(<span class="at">pos=</span>sod2<span class="sc">$</span>pos), <span class="at">FUN=</span>sum)</span>
<span id="cb24-3"><a href="pileup.html#cb24-3" tabindex="-1"></a><span class="fu">head</span>(coverage)</span></code></pre></div>
<pre><code>##         pos count
## 1 160103505   299
## 2 160103506   297
## 3 160103507   297
## 4 160103508   291
## 5 160103509   292
## 6 160103510   290</code></pre>
<p>Your task now is to calculate this per-position coverage for all genes and to calculate and report on - for each gene:</p>
<ul>
<li>the number of bases sequenced for this gene,</li>
<li>the average coverage of the gene and</li>
<li>the number of low-coverage positions (coverage &lt; 30) both in number <strong>and</strong> as the calculated percentage.</li>
</ul>
<p>Given these tasks and your code from previous assignments, you should be able to do this. Store the calculated values (4 values) combined with the gene name in a new data-frame and show it completely in your lab-journal, ordered by the percentage of low-coverage positions, descending.</p>
<p>The following code can be used to create an empty data-frame and add rows to the data. Note that this isn’t done very often, use and forget. The first line of code (the <code>options</code> function) is needed to stop some annoying R behaviour.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="pileup.html#cb26-1" tabindex="-1"></a><span class="co"># Tell R not to complain...</span></span>
<span id="cb26-2"><a href="pileup.html#cb26-2" tabindex="-1"></a><span class="fu">options</span>(<span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb26-3"><a href="pileup.html#cb26-3" tabindex="-1"></a></span>
<span id="cb26-4"><a href="pileup.html#cb26-4" tabindex="-1"></a><span class="co"># Create empty data-frame, but specify columns and data types</span></span>
<span id="cb26-5"><a href="pileup.html#cb26-5" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Name=</span><span class="fu">character</span>(), <span class="at">Course=</span><span class="fu">character</span>(), <span class="at">Grade=</span><span class="fu">numeric</span>())</span>
<span id="cb26-6"><a href="pileup.html#cb26-6" tabindex="-1"></a></span>
<span id="cb26-7"><a href="pileup.html#cb26-7" tabindex="-1"></a><span class="co"># Create a new row of data, stored as a named list (important)</span></span>
<span id="cb26-8"><a href="pileup.html#cb26-8" tabindex="-1"></a>new_row <span class="ot">=</span> <span class="fu">list</span>(<span class="at">Name=</span><span class="st">&quot;James&quot;</span>, <span class="at">Course=</span><span class="st">&quot;Math&quot;</span>, <span class="at">Grade=</span><span class="fl">7.5</span>)</span>
<span id="cb26-9"><a href="pileup.html#cb26-9" tabindex="-1"></a></span>
<span id="cb26-10"><a href="pileup.html#cb26-10" tabindex="-1"></a><span class="co"># Append data to the data-frame using rbind</span></span>
<span id="cb26-11"><a href="pileup.html#cb26-11" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(df, new_row)</span>
<span id="cb26-12"><a href="pileup.html#cb26-12" tabindex="-1"></a></span>
<span id="cb26-13"><a href="pileup.html#cb26-13" tabindex="-1"></a><span class="co"># Or within a single line</span></span>
<span id="cb26-14"><a href="pileup.html#cb26-14" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(df, <span class="fu">list</span>(<span class="at">Name=</span><span class="st">&quot;Wendy&quot;</span>, <span class="at">Course=</span><span class="st">&quot;Math&quot;</span>, <span class="at">Grade=</span><span class="dv">8</span>))</span>
<span id="cb26-15"><a href="pileup.html#cb26-15" tabindex="-1"></a></span>
<span id="cb26-16"><a href="pileup.html#cb26-16" tabindex="-1"></a><span class="co"># print</span></span>
<span id="cb26-17"><a href="pileup.html#cb26-17" tabindex="-1"></a>df</span></code></pre></div>
<pre><code>##    Name Course Grade
## 1 James   Math   7.5
## 2 Wendy   Math   8.0</code></pre>
<div id="hints" class="section level4 unnumbered hasAnchor">
<h4>Hints<a href="pileup.html#hints" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>As with the other assignments using iteration, create the data-frame <em>outside</em> of the <code>for</code>-loop and perform the <code>rbind</code> <em>within</em> the <code>for</code>-loop.</li>
<li>Take a good look (and print while testing) at <em>what</em> you are iterating over; in this case a <code>list</code> containing <code>data-frames</code>.</li>
<li>You need to re-use the <code>aggregate</code> code but adjust it to make sure it uses the data you get each iteration</li>
<li>Store each calculated value in a variable within the <code>for</code>-loop and check (print) them as mistakes are easily made.</li>
</ul>
</div>
</div>
<div id="end-result" class="section level3 unnumbered hasAnchor">
<h3>End Result<a href="pileup.html#end-result" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Below is an example of data you might get when you have completed this assignment. Note that all values as well as the column names will be different in your case.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="pileup.html#cb28-1" tabindex="-1"></a><span class="co"># Load example data</span></span>
<span id="cb28-2"><a href="pileup.html#cb28-2" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;data/statistics.RData&quot;</span>)</span>
<span id="cb28-3"><a href="pileup.html#cb28-3" tabindex="-1"></a></span>
<span id="cb28-4"><a href="pileup.html#cb28-4" tabindex="-1"></a>statistics</span></code></pre></div>
<pre><code>##        length avg_coverage low_coverage low_coverage_perc
## ABCC9    6348        249.2            0               0.0
## ACTC1    1375        192.4           57               4.1
## ACTN2    3527        184.5            0               0.0
## ANKRD1   1322        232.4            0               0.0
## BAG3     1892        207.7            0               0.0
## CALR3    1511        242.5            0               0.0
## CAV3      536        196.0            0               0.0
## CRYAB     650        156.8            0               0.0
## CSRP3     785        230.6            0               0.0
## DES      1774        122.9          258              14.5
## DMD     14643        248.7            0               0.0
## DSC2     3424        237.9          109               3.2
## DSG2     3959        239.1           86               2.2
## DSP      9577        237.4            4               0.0
## DTNA     3133        238.0            0               0.0
## EMD      1006        169.9            0               0.0
## EYA4     2683        251.9            0               0.0
## GATAD1   1010        183.3          210              20.8
## GLA      1570        237.6            0               0.0
## JPH2     2292         88.7          699              30.5
## JUP      2758         78.2          276              10.0
## LAMA4    7193        236.0            0               0.0
## LAMP2    1957        240.1            0               0.0
## LDB3     3148        144.0           78               2.5
## LMNA     2496         81.6          118               4.7
## MYBPC3   5195        121.8          503               9.7
## MYH6     7301        200.1           32               0.4
## MYH7     7329        205.0            0               0.0
## MYL2      781        211.4            1               0.1
## MYL3      828        164.4            0               0.0
## MYOZ1    1100        230.5            0               0.0
## MYOZ2     995        252.1            0               0.0
## MYPN     4723        243.7            0               0.0
## NEXN     2511        247.7            0               0.0
## PKP2     3206        207.9          263               8.2
## PLN       199        233.8            0               0.0
## PRKAG2   2350        183.2          349              14.9
## PSEN1    1804        241.4            0               0.0
## PSEN2    1747        150.2           56               3.2
## RBM20    4243        215.7          230               5.4
## RYR2    19104        246.3           88               0.5
## SCN5A    6633        162.7          275               4.1
## SGCD     1193        232.9            0               0.0
## SOD2      869        184.4            6               0.7
## TAZ      1400        168.5            0               0.0
## TBX20    1664        193.4          167              10.0
## TCAP      584         80.6            0               0.0
## TMEM43   1683        179.5           52               3.1
## TNNC1     726        175.0            0               0.0
## TNNI3     953        105.2            0               0.0
## TNNT2    1458        200.3           24               1.6
## TPM1     1941        183.4          326              16.8
## TTN    123059        250.0            0               0.0
## TXNRD2   2241        132.8          116               5.2
## VCL      4285        210.5           89               2.1</code></pre>
<p>Make sure the complete report is visible in the lab journal. Reflect on the results obtained; are there any genes that require further inspection? If so, use IGV to check if the low-coverage positions are due to a lack of reads or if there are other reasons for this (include screenshot(s) in your lab journal).</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="mapping.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="variants.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
